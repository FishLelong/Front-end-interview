/* src/pages/Dough.svelte generated by Svelte v3.29.0 */
import {
	SvelteComponent,
	append,
	attr,
	component_subscribe,
	create_component,
	destroy_component,
	detach,
	element,
	init,
	insert,
	listen,
	mount_component,
	safe_not_equal,
	set_data,
	space,
	text,
	transition_in,
	transition_out
} from "../../web_modules/svelte/internal.js";

import BigNumber from "../../web_modules/bignumberjs.js";
import images from "../config/images.json.proxy.js";
import FarmerTable from "../components/FarmerTable.js";
import { farming } from "../stores/eth/writables.js";
import { formatFiat, toFixed, subscribeToBalance } from "../components/helpers.js";
import { balanceKey, balances, contract } from "../stores/eth.js";

function create_fragment(ctx) {
	let div32;
	let img0;
	let img0_src_value;
	let t0;
	let div0;
	let t3;
	let div3;
	let div1;
	let t4;
	let strong1;
	let t5_value = formatFiat(/*circulatingSupply*/ ctx[2], ",", ".", "") + "";
	let t5;
	let t6;
	let t7;
	let div2;
	let t8;
	let strong2;
	let t9_value = formatFiat(/*doughStaked*/ ctx[0], ",", ".", "") + "";
	let t9;
	let t10;
	let t11;
	let div5;
	let div4;
	let t12;
	let strong3;
	let t13;
	let t14;
	let t15;
	let a0;
	let t17;
	let button1;
	let t19;
	let div18;
	let t35;
	let a1;
	let a1_href_value;
	let t37;
	let img1;
	let img1_src_value;
	let t38;
	let h10;
	let t40;
	let div19;
	let t43;
	let a2;
	let a2_href_value;
	let t45;
	let div23;
	let div21;
	let t57;
	let div22;
	let img2;
	let img2_src_value;
	let t58;
	let div27;
	let div24;
	let img3;
	let img3_src_value;
	let t59;
	let div26;
	let t68;
	let img4;
	let img4_src_value;
	let t69;
	let h13;
	let t71;
	let div28;
	let t73;
	let div29;
	let t76;
	let div30;
	let t79;
	let a5;
	let a5_href_value;
	let t81;
	let h14;
	let t83;
	let div31;
	let farmertable;
	let current;
	let mounted;
	let dispose;
	farmertable = new FarmerTable({});

	return {
		c() {
			div32 = element("div");
			img0 = element("img");
			t0 = space();
			div0 = element("div");
			div0.innerHTML = `<strong>DOUGH</strong> is the PieDAO governance token. Owning DOUGH makes you a member of PieDAO. Holders are capable of participating in the DAOâ€™s governance votes and proposing votes of their own. <br/>`;
			t3 = space();
			div3 = element("div");
			div1 = element("div");
			t4 = text("Circulating supply: ");
			strong1 = element("strong");
			t5 = text(t5_value);
			t6 = text(" DOUGH");
			t7 = space();
			div2 = element("div");
			t8 = text("Staked: ");
			strong2 = element("strong");
			t9 = text(t9_value);
			t10 = text(" DOUGH");
			t11 = space();
			div5 = element("div");
			div4 = element("div");
			t12 = text("Price: ");
			strong3 = element("strong");
			t13 = text(/*price*/ ctx[1]);
			t14 = text("$ / DOUGH");
			t15 = space();
			a0 = element("a");
			a0.innerHTML = `<button class="btn m-0 mt-4 rounded-8px p-15px min-w-200px w-800px">Market Buy</button>`;
			t17 = space();
			button1 = element("button");
			button1.textContent = "Add to MetaMask ðŸ¦Š";
			t19 = space();
			div18 = element("div");

			div18.innerHTML = `<div class="p-0 md:w-1/4"><div class="text-center font-thin text-xs md:text-base">PieDAO</div> 
      <div class="text-center text-2xl md:text-xl font-black">Governance</div></div> 
    <div class="p-0 md:w-1/4"><div class="text-center font-thin text-xs md:text-base">Value accrual</div> 
      <div class="text-center text-2xl md:text-xl font-black">Fees</div></div> 
    <div class="p-0 md:w-1/4"><div class="text-center font-thin text-xs md:text-base">Liquidity</div> 
        <div class="text-center text-2xl md:text-xl font-black">Mining</div></div> 
    <div class="p-0 md:w-1/4"><div class="text-center font-thin text-xs md:text-base">DAOs Meta</div> 
      <div class="text-center text-2xl md:text-xl font-black">Governance</div></div>`;

			t35 = space();
			a1 = element("a");
			a1.textContent = "Learn more on Medium";
			t37 = space();
			img1 = element("img");
			t38 = space();
			h10 = element("h1");
			h10.textContent = "Token Migration";
			t40 = space();
			div19 = element("div");

			div19.innerHTML = `PieDAO is entering the next phase of its mission to democratize the access to wealth allocation strategies by migrating the currently non-transferable token (DOUGHv1) to a transferable one (DOUGHv2).<br/>
    To further develop the community and to incentivize early adopters through the liquidity mining program the community believes the time is right to start the migration of DOUGH to DOUGH v2.<br/>`;

			t43 = space();
			a2 = element("a");
			a2.textContent = "DOUGH Migration on Medium";
			t45 = space();
			div23 = element("div");
			div21 = element("div");

			div21.innerHTML = `<h1 class="text-lg md:text-xl">Vesting Period</h1> 
        <div class="font-thin text-xs mt-2 md:mt-4 md:text-base">To align incentives early token requests were accepted at a lower rate then later ones but are subject to longer vesting periods. DOUGH holders are subject to the following vesting schedules:<br/> 
            <ul class="list-disc list-inside mt-2 md:mt-4"><li>Contribution on Epoch 1 (from block to block) 1.5y vesting</li> 
                <li>Contribution on Epoch 2 (from block to block) 1y vesting</li> 
                <li>Summoners 3y vesting</li> 
                <li>Bounties, no vesting applied</li></ul></div>`;

			t57 = space();
			div22 = element("div");
			img2 = element("img");
			t58 = space();
			div27 = element("div");
			div24 = element("div");
			img3 = element("img");
			t59 = space();
			div26 = element("div");

			div26.innerHTML = `<h1 class="text-lg md:text-xl">How to Migrate</h1> 
        <div class="font-thin text-xs mt-2 md:mt-4 md:text-base">To make the process as simple as possible an Aragon app will be installed which allows you to migrate your tokens.<br/>
            By visiting the Aragon interface of PieDAO and opening the migration app you can easily migrate your already vested tokens to DOUGH v2.
            The interface will automatically fill in the maximum amount you are able to migrate.<br/> 
            <a class="font-bold mt-4 md:mt-4" target="_blank" href="${`https://medium.com/piedao/dough-farming-season-7329ea5e84dd`}">Migration Tutorial</a><br/> 
            <a class="font-bold mt-4 md:mt-4" target="_blank" href="${`https://client.aragon.org/?#/piedao/0x968986e7ab9d05b4f6334efdc6c4c5efd89d4119/`}">Migrate Now</a></div>`;

			t68 = space();
			img4 = element("img");
			t69 = space();
			h13 = element("h1");
			h13.textContent = "Liquidity Mining";
			t71 = space();
			div28 = element("div");
			div28.textContent = "With the imminent migration to the DOUGH v2 governance token and the launch of the DOUGH / ETH liquidity pool on Balancer, PieDAO will also open its DOUGH farming season!";
			t73 = space();
			div29 = element("div");
			div29.innerHTML = `<strong>Incentives: </strong>60,000,000 DOUGH v2 tokens (60% of total) will be locked in a vault off-circulation and assigned to the DAO to promote its development overtime through liquidity mining programs and other incentives.`;
			t76 = space();
			div30 = element("div");
			div30.innerHTML = `<strong>Eligibility: </strong>All Liquidity Providers to selected pools will be eligible for these incentive programs by staking their LP tokens to PieDAO staking contract.`;
			t79 = space();
			a5 = element("a");
			a5.textContent = "Farming Season on Medium";
			t81 = space();
			h14 = element("h1");
			h14.textContent = "Available Pools";
			t83 = space();
			div31 = element("div");
			create_component(farmertable.$$.fragment);
			attr(img0, "class", "w-100pc h-auto md:w-100pc h-auto");
			if (img0.src !== (img0_src_value = images.herodough)) attr(img0, "src", img0_src_value);
			attr(img0, "alt", "PieDAO Hero");
			attr(div0, "class", "text-center font-thin text-xs mt-8 md:mt-20 md:text-lg");
			attr(div1, "class", "bg-black text-white p-2 rounded-sm text-center");
			attr(div2, "class", "bg-black text-white p-2 mx-5 rounded-sm text-center");
			attr(div3, "class", "flex justify-around my-2");
			attr(div4, "class", "text-center p-4 text-2xl md:text-xl");
			attr(a0, "href", "https://balancer.exchange/#/swap/ether/0xad32A8e6220741182940c5aBF610bDE99E737b2D");
			attr(a0, "target", "_blank");
			attr(button1, "class", "table-btn mt-4");
			attr(div5, "class", "rounded-sm p-8 flex flex-col justify-between content-center items-center flex-wrap mt-4 md:mt-4");
			attr(div18, "class", "bg-grey-243 rounded-sm pt-8 pb-8 flex justify-between flex-wrap w-full mt-4 md:mt-8");
			attr(a1, "class", "singleTag font-bold mt-4 md:mt-4");
			attr(a1, "target", "_blank");
			attr(a1, "href", a1_href_value = `https://medium.com/piedao/dough-tokens-d2479c7ea608`);
			attr(img1, "class", "w-20pc h-auto mt-8 l md:mt-12 md:w-20pc");
			if (img1.src !== (img1_src_value = images.tokenmigration)) attr(img1, "src", img1_src_value);
			attr(img1, "alt", "DOUGH Migration");
			attr(h10, "class", "text-center text-lg  mt-8 md:text-xl md:mt-12");
			attr(div19, "class", "text-center font-thin text-xs mt-2 md:mt-4 md:text-lg");
			attr(a2, "class", "singleTag font-bold mt-4 md:mt-4");
			attr(a2, "target", "_blank");
			attr(a2, "href", a2_href_value = `https://medium.com/piedao/piedao-token-migration-d2e9cd5d1a16`);
			attr(div21, "class", "p-4 flex justify-center items-center content-center flex-wrap md:w-2/3");
			attr(img2, "class", "w-100pc h-full md:h-auto md:w-100pc");
			if (img2.src !== (img2_src_value = images.vestingperiod)) attr(img2, "src", img2_src_value);
			attr(img2, "alt", "PieDAO Hero");
			attr(div22, "class", "p-4 flex justify-center w-full flex-wrap md:w-1/3 p-16");
			attr(div23, "class", "bg-grey-243 rounded-sm p-8 flex justify-between flex-wrap w-full mt-8 md:mt-20");
			attr(img3, "class", "w-100pc h-full h-auto md:w-100pc");
			if (img3.src !== (img3_src_value = images.howtomigrate)) attr(img3, "src", img3_src_value);
			attr(img3, "alt", "PieDAO Hero");
			attr(div24, "class", "p-4 flex justify-center w-full flex-wrap md:w-1/3 p-16");
			attr(div26, "class", "p-4 flex justify-center items-center content-center flex-wrap md:w-2/3");
			attr(div27, "class", "bg-grey-243 rounded-sm p-8 flex justify-between flex-wrap w-full mt-4 md:mt-8");
			attr(img4, "class", "w-25pc h-auto mt-8 l md:mt-16 md:w-25pc h-auto");
			if (img4.src !== (img4_src_value = images.liquiditymining)) attr(img4, "src", img4_src_value);
			attr(img4, "alt", "PieDAO Hero");
			attr(h13, "class", "text-center text-lg  mt-8 md:text-xl md:mt-12");
			attr(div28, "class", "text-left font-thin text-xs mt-2 md:mt-4 md:text-lg");
			attr(div29, "class", "text-left font-thin text-xs mt-2 md:mt-4 md:text-lg");
			attr(div30, "class", "text-left font-thin text-xs mt-2 md:mt-4 md:text-lg");
			attr(a5, "class", "singleTag font-bold mt-4 md:mt-4");
			attr(a5, "target", "_blank");
			attr(a5, "href", a5_href_value = `https://medium.com/piedao/dough-farming-season-7329ea5e84dd`);
			attr(h14, "class", "text-center text-lg  mt-8 md:text-xl md:mt-12");
			attr(div31, "class", "liquidity-container flex flex-col align-center bg-grey-243 rounded-4px p-4 my-4 md:p-6 w-full");
			attr(div32, "class", "content flex flex-col spl");
		},
		m(target, anchor) {
			insert(target, div32, anchor);
			append(div32, img0);
			append(div32, t0);
			append(div32, div0);
			append(div32, t3);
			append(div32, div3);
			append(div3, div1);
			append(div1, t4);
			append(div1, strong1);
			append(strong1, t5);
			append(strong1, t6);
			append(div3, t7);
			append(div3, div2);
			append(div2, t8);
			append(div2, strong2);
			append(strong2, t9);
			append(strong2, t10);
			append(div32, t11);
			append(div32, div5);
			append(div5, div4);
			append(div4, t12);
			append(div4, strong3);
			append(strong3, t13);
			append(strong3, t14);
			append(div5, t15);
			append(div5, a0);
			append(div5, t17);
			append(div5, button1);
			append(div32, t19);
			append(div32, div18);
			append(div32, t35);
			append(div32, a1);
			append(div32, t37);
			append(div32, img1);
			append(div32, t38);
			append(div32, h10);
			append(div32, t40);
			append(div32, div19);
			append(div32, t43);
			append(div32, a2);
			append(div32, t45);
			append(div32, div23);
			append(div23, div21);
			append(div23, t57);
			append(div23, div22);
			append(div22, img2);
			append(div32, t58);
			append(div32, div27);
			append(div27, div24);
			append(div24, img3);
			append(div27, t59);
			append(div27, div26);
			append(div32, t68);
			append(div32, img4);
			append(div32, t69);
			append(div32, h13);
			append(div32, t71);
			append(div32, div28);
			append(div32, t73);
			append(div32, div29);
			append(div32, t76);
			append(div32, div30);
			append(div32, t79);
			append(div32, a5);
			append(div32, t81);
			append(div32, h14);
			append(div32, t83);
			append(div32, div31);
			mount_component(farmertable, div31, null);
			current = true;

			if (!mounted) {
				dispose = listen(button1, "click", /*click_handler*/ ctx[4]);
				mounted = true;
			}
		},
		p(ctx, [dirty]) {
			if ((!current || dirty & /*circulatingSupply*/ 4) && t5_value !== (t5_value = formatFiat(/*circulatingSupply*/ ctx[2], ",", ".", "") + "")) set_data(t5, t5_value);
			if ((!current || dirty & /*doughStaked*/ 1) && t9_value !== (t9_value = formatFiat(/*doughStaked*/ ctx[0], ",", ".", "") + "")) set_data(t9, t9_value);
			if (!current || dirty & /*price*/ 2) set_data(t13, /*price*/ ctx[1]);
		},
		i(local) {
			if (current) return;
			transition_in(farmertable.$$.fragment, local);
			current = true;
		},
		o(local) {
			transition_out(farmertable.$$.fragment, local);
			current = false;
		},
		d(detaching) {
			if (detaching) detach(div32);
			destroy_component(farmertable);
			mounted = false;
			dispose();
		}
	};
}

const DOUGH = "0xad32A8e6220741182940c5aBF610bDE99E737b2D";
const DAO = "0x4efD8CEad66bb0fA64C8d53eBE65f31663199C6d";
const MULTISIG = "0x3bFdA5285416eB06Ebc8bc0aBf7d105813af06d0";

function instance($$self, $$props, $$invalidate) {
	let $balances;
	let $farming;
	component_subscribe($$self, balances, $$value => $$invalidate(7, $balances = $$value));
	component_subscribe($$self, farming, $$value => $$invalidate(8, $farming = $$value));
	let daoBalanceKey;
	let msBalanceKey;
	let doughStaked;
	let price = "n/a";
	let circulatingSupply = 0;

	const addToken = () => {
		ethereum.sendAsync(
			{
				method: "wallet_watchAsset",
				params: {
					"type": "ERC20",
					"options": {
						"address": "0xad32A8e6220741182940c5aBF610bDE99E737b2D",
						"symbol": "DOUGH",
						"decimals": 18,
						"image": "https://raw.githubusercontent.com/pie-dao/brand/master/DOUGH%20Token/DOUGH2v.png"
					}
				},
				id: Math.round(Math.random() * 100000)
			},
			(err, added) => {
				if (added) {
					console.log("Thanks for your interest!");
				} else {
					alert("Something went wrong. Is Metamask there?");
				}
			}
		);
	};

	const click_handler = () => addToken();

	$$self.$$.update = () => {
		if ($$self.$$.dirty & /*$balances, daoBalanceKey, msBalanceKey, $farming*/ 480) {
			$: (async () => {
				const doughToken = await contract({ address: DOUGH });

				// DAO
				subscribeToBalance(DOUGH, DAO, true);

				// Multisig
				subscribeToBalance(DOUGH, MULTISIG, true);

				$$invalidate(5, daoBalanceKey = balanceKey(DOUGH, DAO));
				$$invalidate(6, msBalanceKey = balanceKey(DOUGH, MULTISIG));
				const totalSupply = await doughToken.totalSupply();
				const daoBal = $balances[daoBalanceKey] || BigNumber(0);
				const msBal = $balances[msBalanceKey] || BigNumber(0);
				$$invalidate(0, doughStaked = $farming["0x8314337d2b13e1A61EadF0FD1686b2134D43762F"].doughStaked.toFixed(2) || 0);
				$$invalidate(1, price = $farming["0x8314337d2b13e1A61EadF0FD1686b2134D43762F"].DOUGHPrice.toFixed(2) || 0);

				if (daoBal > 0 && msBal > 0) {
					const ts = BigNumber(totalSupply.toString()).dividedBy(10 ** 18);
					$$invalidate(2, circulatingSupply = ts.minus(BigNumber(msBal)).minus(BigNumber(daoBal)).toFixed(2));
				}
			})();
		}
	};

	return [doughStaked, price, circulatingSupply, addToken, click_handler];
}

class Dough extends SvelteComponent {
	constructor(options) {
		super();
		init(this, options, instance, create_fragment, safe_not_equal, {});
	}
}

export default Dough;